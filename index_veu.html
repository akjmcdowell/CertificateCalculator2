<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Air Source Heat Pump Models - VEU 1D/3C</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse; /* Ensures borders do not double */
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ccc; /* Adds border to cells */
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f4f4f4; /* Background color for header */
            cursor: pointer; /* Change cursor to pointer for clickable headers */
        }
        .arrow {
            margin-left: 5px;
            font-size: 0.8em; /* Smaller font size for arrows */
        }
        .ascending::after {
            content: ' ▲'; /* Up arrow for ascending sort */
        }
        .descending::after {
            content: ' ▼'; /* Down arrow for descending sort */
        }
    </style>
</head>
<body>
<h1>Air Source Heat Pump Models - VEU 1D/3C</h1>
<p>
    Use this calculator to review the number of Victorian Energy Efficiency Certificates (VEECs) that are eligible for approved products on the <a href="https://www.veu-registry.vic.gov.au/Public/ProductRegistrySearch.aspx" target="_blank">VEU Registry</a>.
</p>

<p>
    Select the year of installation and metropolitan or regional area to reflect ther correct number of certificates for a given scenario.
</p>

<label for="location"><b>Choose Location:</b></label>
<select id="location" name="location">
  <option value="metropolitan">Metropolitan</option>
  <option value="regional">Regional</option>
</select>

<br><br>

<label for="year"><b>Year of Installation:</b></label>
<select id="year" name="year">
  <option value="2024">2024</option>
  <option value="2025">2025</option>
</select>

<br><br>

<label for="brand-filter">Filter by Brand:</label>
<select id="brand-filter">
    <option value="all-brands">All Brands</option>
    <!-- Options will be populated dynamically -->
</select>

<label for="model-filter">Filter by Model:</label>
<select id="model-filter">
    <option value="all-models">All Models</option>
    <!-- Options will be populated dynamically -->
</select>

<p>
    Click on any header to sort by alphabetical or numerical order.
</p>

<table id="data-table">
    <thead>
        <tr>
            <th onclick="sortTable(0, this)">Brand<span class="arrow"></span></th>
            <th onclick="sortTable(1, this)">Model<span class="arrow"></span></th>
            <th onclick="sortTable(2, this)">VEEC: Replace Elec (1D) Zone 4<span class="arrow"></span></th>
            <th onclick="sortTable(3, this)">VEEC: Replace Elec (1D) Zone 5<span class="arrow"></span></th>
            <th onclick="sortTable(4, this)">VEEC: Replace Gas (3C) Zone 4<span class="arrow"></span></th>
            <th onclick="sortTable(5, this)">VEEC: Replace Gas (3C) Zone 5<span class="arrow"></span></th>
        </tr>
    </thead>
    <tbody>
        <!-- Data will be populated here -->
    </tbody>
</table>

<script>
    let jsonData = []; // Declare jsonData at the top
    let currentSortColumn = -1; // Keep track of the currently sorted column
    let currentSortDirection = 'ascending'; // Keep track of the sorting direction

   // Declare variables for VEU parameters
   let EEF, EEFm, AF_1D, SEF_1D, AEF_1D, AF_3C, SEF_3C, AEF_3C, i;

    // Function to update VEU parameters based on dropdown selections
    function updateVEUParameters() {
        const location = document.getElementById("location").value;
        const year = document.getElementById("year").value;

        // Set EEF parameters based on year
        switch (year) {
            case "2024":
                EEF = 0.5334;
                EEFm = 0.433;
                break;
            case "2025":
                EEF = 0.393;
                EEFm = 0.393;
                break;
            default:
                EEF = 0.5334;
                EEFm = 0.433;
        }

        // Set AF, SEF, and AEF parameters based on location
        switch (location) {
            case "metropolitan":
                AF_1D = 33.4;
                SEF_1D = 3.27;
                AEF_1D = 3.27;
                AF_3C = 13.23;
                SEF_3C = 4.17;
                AEF_3C = 4.17;
                break;
            case "regional":
                AF_1D = 35.44;
                SEF_1D = 3.47;
                AEF_1D = 3.47;
                AF_3C = 13.23;
                SEF_3C = 4.17;
                AEF_3C = 4.17;
                break;
            default:
                AF_1D = 33.4;
                SEF_1D = 3.27;
                AEF_1D = 3.27;
                AF_3C = 13.23;
                SEF_3C = 4.17;
                AEF_3C = 4.17;
        }
    }


    // Fetch JSON data from GitHub
    fetch('https://raw.githubusercontent.com/akjmcdowell/CertificateCalculator/refs/heads/main/VEU.json')
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
        }
        return response.json();
    })
    .then(data => {
        jsonData = data; // Assign fetched data to jsonData
        console.log(jsonData); // Log the JSON data for debugging
        populateTable(jsonData); // Populate the table initially
        populateBrandFilter(jsonData); // Populate the brand filter
        populateModelFilter(jsonData); // Populate the model filter
    })
    .catch(error => {
        console.error('There was a problem with the fetch operation:', error);
    });

    // Function to populate the table with data
    function populateTable(data) {
        const tableBody = document.getElementById('data-table').getElementsByTagName('tbody')[0];
        tableBody.innerHTML = ''; // Clear existing data
        updateVEUParameters();

        data.forEach(item => {
            const row = document.createElement('tr');         
            
            let Bs_Z4 = item["Zone 4 Bs"];
            let Bs_Z5 = item["Zone 5 Bs"];
            let Be_Z4 = item["Zone 4 Be"];
            let Be_Z5 = item["Zone 5 Be"];
            
            // Create individual cells (td) and assign values
            let brandCell = document.createElement('td');
            brandCell.textContent = item.Brand;

            let modelCell = document.createElement('td');
            modelCell.textContent = item.Model;

            let VEEC_1D_Z4 = document.createElement('td');
            let VEEC_1D_Z5 = document.createElement('td');
            let VEEC_3C_Z4 = document.createElement('td');
            let VEEC_3C_Z5 = document.createElement('td');

            if (Bs_Z4>0) {
                VEEC_1D_Z4.textContent = Math.round((AF_1D - SEF_1D * Bs_Z4 - AEF_1D * Be_Z4) * EEF);
                VEEC_3C_Z4.textContent = Math.round(AF_3C - (SEF_3C * Bs_Z4 + AEF_3C * Be_Z4) * EEFm);
                console.log("Bs_Z4:", Bs_Z4, "Be_Z4:", Be_Z4, "AF_1D:",AF_1D);
            } else {
                VEEC_1D_Z4.textContent = 0;
                VEEC_3C_Z4.textContent = 0;
            }

            if (Bs_Z5>0) {
                VEEC_1D_Z5.textContent = Math.round((AF_1D - SEF_1D * Bs_Z5 - AEF_1D * Be_Z5) * EEF);
                VEEC_3C_Z5.textContent = Math.round(AF_3C - (SEF_3C * Bs_Z5 + AEF_3C * Be_Z5) * EEFm);
            } else {
                VEEC_1D_Z5.textContent = 0;
                VEEC_3C_Z5.textContent = 0;
            }
         
            // Append cells to the row
            row.appendChild(brandCell);
            row.appendChild(modelCell);
            row.appendChild(VEEC_1D_Z4);
            row.appendChild(VEEC_1D_Z5);
            row.appendChild(VEEC_3C_Z4);
            row.appendChild(VEEC_3C_Z5);

            // Append the row to the table body
            tableBody.appendChild(row);
        });
    }

    // Populate the dropdown with unique brands
    function populateBrandFilter(data) {
        const brandFilter = document.getElementById('brand-filter');
        const brands = [...new Set(data.map(item => item.Brand))]; // Get unique brands

        brands.forEach(brand => {
            const option = document.createElement('option');
            option.value = brand;
            option.textContent = brand;
            brandFilter.appendChild(option); // Append brand options to the dropdown
        });
    }

    // Populate the dropdown with models based on selected brand
    function populateModelFilter(data, selectedBrand = 'all-brands') {
        const modelFilter = document.getElementById('model-filter');
        modelFilter.innerHTML = '<option value="all-models">All Models</option>'; // Reset model options

        const filteredModels = selectedBrand === 'all-brands'
            ? [...new Set(data.map(item => item.Model))]
            : [...new Set(data.filter(item => item.Brand === selectedBrand).map(item => item.Model))];

        filteredModels.forEach(model => {
            const option = document.createElement('option');
            option.value = model;
            option.textContent = model;
            modelFilter.appendChild(option); // Append model options to the dropdown
        });
    }

    // Event listeners for dropdown changes
    document.getElementById('location').addEventListener('change', function() {
        updateVEUParameters(); // Update parameters on location change
        const selectedBrand = document.getElementById('brand-filter').value;
        const selectedModel = document.getElementById('model-filter').value;

        const filteredData = (selectedBrand === 'all-brands' && selectedModel === 'all-models')
            ? jsonData
            : jsonData.filter(item => 
                (selectedBrand === 'all-brands' || item.Brand === selectedBrand) && 
                (selectedModel === 'all-models' || item.Model === selectedModel)
            );

        populateTable(filteredData); // Update table with filtered data
    });

    document.getElementById('year').addEventListener('change', function() {
        updateVEUParameters(); // Update parameters on year change
        const selectedBrand = document.getElementById('brand-filter').value;
        const selectedModel = document.getElementById('model-filter').value;

        const filteredData = (selectedBrand === 'all-brands' && selectedModel === 'all-models')
            ? jsonData
            : jsonData.filter(item => 
                (selectedBrand === 'all-brands' || item.Brand === selectedBrand) && 
                (selectedModel === 'all-models' || item.Model === selectedModel)
            );

        populateTable(filteredData); // Update table with filtered data
    });

    // Filter data based on selected brand
    document.getElementById('brand-filter').addEventListener('change', function() {
        const selectedBrand = this.value;
        populateModelFilter(jsonData, selectedBrand); // Update model filter based on selected brand
        const filteredData = selectedBrand === 'all-brands' ? jsonData : jsonData.filter(item => item.Brand === selectedBrand);
        populateTable(filteredData); // Update table with filtered data
    });

    // Filter data based on selected model
    document.getElementById('model-filter').addEventListener('change', function() {
        const selectedBrand = document.getElementById('brand-filter').value;
        const selectedModel = this.value;
        
        const filteredData = (selectedBrand === 'all-brands' && selectedModel === 'all-models')
            ? jsonData
            : jsonData.filter(item => 
                (selectedBrand === 'all-brands' || item.Brand === selectedBrand) && 
                (selectedModel === 'all-models' || item.Model === selectedModel)
            );

        populateTable(filteredData); // Update table with filtered data
    });

    function sortTable(columnIndex, header) {
        const table = document.getElementById("data-table");
        const rows = Array.from(table.getElementsByTagName("tr")).slice(1); // Get all rows except the header

        // Reset all headers' arrows
        Array.from(table.getElementsByTagName("th")).forEach(th => {
            th.classList.remove('ascending', 'descending');
        });

        // Determine sorting direction
        if (columnIndex === currentSortColumn) {
            currentSortDirection = currentSortDirection === 'ascending' ? 'descending' : 'ascending';
        } else {
            currentSortDirection = 'descending'; // Reset to ascending if a new column is sorted
        }
        currentSortColumn = columnIndex;

        // Add the appropriate class for the arrow direction
        if (header) {
            header.classList.add(currentSortDirection);
        }

        // Sort rows based on current direction
        rows.sort((rowA, rowB) => {
            const xContent = rowA.getElementsByTagName("td")[columnIndex].textContent.trim() || "";
            const yContent = rowB.getElementsByTagName("td")[columnIndex].textContent.trim() || "";

            // Convert to float for comparison if the column represents numbers
            const isNumberColumn = columnIndex >= 2; // Columns 2 and beyond contain numeric values

            if (isNumberColumn) {
                const xNum = parseFloat(xContent);
                const yNum = parseFloat(yContent);
                return currentSortDirection === 'ascending' ? xNum - yNum : yNum - xNum;
            } else {
                // For Brand and Model (String comparison)
                return currentSortDirection === 'ascending' ? xContent.localeCompare(yContent) : yContent.localeCompare(xContent);
            }
        });

        // Append sorted rows back to the table body
        const tableBody = table.getElementsByTagName('tbody')[0];
        rows.forEach(row => tableBody.appendChild(row));
    }

</script>

</body>
</html>
